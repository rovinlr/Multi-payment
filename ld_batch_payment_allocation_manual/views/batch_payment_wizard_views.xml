<odoo>
  <data>
    <record id="view_batch_payment_allocation_wizard_form" model="ir.ui.view">
      <field name="name">batch.payment.allocation.wizard.form</field>
      <field name="model">batch.payment.allocation.wizard</field>
      <field name="arch" type="xml">
        <form string="Batch Payment Allocation (Manual)">
          <group>
            <group>
              <field name="partner_type"/>
              <field name="partner_id"/>
              <field name="company_id"/>
            </group>
            <group>
              <field name="journal_id"/>
              <field name="payment_method_line_id" domain="[('journal_id','=',journal_id)]"/>
              <field name="payment_currency_id"/>
              <field name="payment_date"/>
              <field name="communication"/>
            </group>
          </group>

          <group>
            <field name="line_ids" widget="one2many_list">
              <list editable="bottom">
                <field name="move_id" domain="[('state','=','posted'),('payment_state','in',('not_paid','partial')),('commercial_partner_id','=',parent.partner_id.commercial_partner_id),('move_type','in',('out_invoice','in_invoice'))]" options="{'no_create': True, 'no_open': False}"/>
                <field name="invoice_date"/>
                <field name="invoice_amount_total" readonly="1"/>
                <field name="invoice_currency_id" readonly="1"/>
                <field name="residual_in_payment_currency" readonly="1"/>
                <field name="currency_id" invisible="1"/>
                <field name="amount_to_pay"/>
              </list>
            </field>
          </group>

          <group>
            <field name="total_allocation" readonly="1"/>
          </group>

          <footer>
            <button name="action_load_invoices" string="Load Invoices" type="object"/>
            <button name="action_clear_lines" string="Clear Lines" type="object"/>
            <button name="action_confirm" string="Create Payment &amp; Allocate" type="object" class="oe_highlight"/>
            <button string="Cancel" special="cancel"/>
          </footer>
        </form>
      </field>
    </record>
  </data>
</odoo>